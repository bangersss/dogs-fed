<body>
  <h1>Score (Last 14 days)</h1>

  <div id="loading">Loading...</div>

  <div id="tallyContainer" style="display: none;">
    <table>
      <thead>
        <tr>
          <th>Person</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody id="tallyBody">
        <tr><td>Ben</td><td id="countB">0</td></tr>
        <tr><td>Enya</td><td id="countE">0</td></tr>
        <tr><td>Alicia</td><td id="countA">0</td></tr>
      </tbody>
    </table>
  </div>

  <button
    id="navButton"
    style="background-color: black; color: white; border: none; border-radius: 25px; padding: 12px 30px; font-size: 16px; cursor: pointer;"
    onclick="location.href='index.html'"
  >
    Back
  </button>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDGV8bO2kgM67p_-9-bpZiiKkkJrbIIs4g",
      authDomain: "dogs-fed.firebaseapp.com",
      databaseURL: "https://dogs-fed-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "dogs-fed",
      storageBucket: "dogs-fed.firebasestorage.app",
      messagingSenderId: "122026065319",
      appId: "1:122026319:web:e8bdba2c12c00d9bc50a82",
      measurementId: "G-GBYZLP47GX"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const today = new Date();
    const counts = { B: 0, E: 0, A: 0 };
    const daysToCheck = 14;

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function fetchDayData(dateStr) {
      return db.ref('dog_feed/' + dateStr).get().then(snapshot => {
        const dayData = snapshot.val();
        if (dayData) {
          ['morning', 'night'].forEach(period => {
            const feeder = dayData[period];
            if (feeder && counts.hasOwnProperty(feeder)) {
              counts[feeder]++;
            }
          });
        }
      }).catch(err => {
        console.error("Error fetching data for", dateStr, err);
      });
    }

    async function fetchAllData() {
      for (let i = 0; i < daysToCheck; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = formatDate(date);
        await fetchDayData(dateStr);
      }

      document.getElementById('countB').textContent = counts.B;
      document.getElementById('countE').textContent = counts.E;
      document.getElementById('countA').textContent = counts.A;

      // Show table, hide loader
      document.getElementById('tallyContainer').style.display = 'block';
      document.getElementById('loading').style.display = 'none';
    }

    fetchAllData();
  </script>
</body>
